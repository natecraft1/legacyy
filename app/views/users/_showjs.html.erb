<script>
$(document).ready(function() {
  

  $('#year_year').val(gon.currentyr);
  $('#edit_year_hidden').val("<%= params[:age] %>");

  $('.intro span').html(gon.currentyr);
  $('.edit_year').hide();
  if (gon.posts.length > 0) { 
    $('div.what_i_did').html(gon.posts[0].what_i_did);
    $('div.lesson').html(gon.posts[0].lesson_or_story);
  }

  // $.post( "/<%= @user.name %>/" + val, { page: val } function() {
  //     console.log("sent");
  // });

  findContent(gon.currentyr);
  
  function findContent(value) {  
    for (var i=0; i<gon.posts.length; i++) {
      if (gon.posts[i].year == value)
      {
        // hide the form if there is content for the selected year
        // $('.avatar').html("<%= image_tag @currentyr.avatar.url %>");

        $('.new_year').hide();
        $('.edit').show();
        what_i_did = gon.posts[i].what_i_did;
        lesson_or_story = gon.posts[i].lesson_or_story;
        insertContent(what_i_did, lesson_or_story);
        $.ajax({ 
          url: "/users/<%= @user.name %>/years/" + value, 
          type: "GET",
          dataType: 'json',
          success: function(data) {
            console.log(data);
            $(".edit_year > .year_what_i_did > .controls > #year_what_i_did").val(data.what_i_did);
            $(".edit_year > .year_lesson_or_story > .controls > #year_lesson_or_story").val(data.lesson_or_story);
            $(".avatar").attr("src", data.avatar_url);
            console.log('this is the image url');
            console.log( data.avatar_url);

          }
        });
        break;
      }
      else {
        // show form if there's no match
        $('.avatar').html("");
        $('.edit').hide();
        $('.edit_year').hide();
        $('.new_year').show();
        $('.what_i_did').html('');
        $('.lesson').html('');
      }
    }
  }
  function insertContent(what, lesson) {
    $('div.lesson').html('');
    $('div.what_i_did').html('');
    $('.what_i_did').html(what);
    $('.lesson').html(lesson);
  }
  // function arrowClick(value) {
  //   $(".arrow").click(function(event) {
  //     event.preventDefault();
  //     //might need ajax call to get params
  //   });
  // }
  $('.edit').click(function() {
    $('.edit_year').toggle('slow', function() {      
    });
    $('.edit_year').val("Update year");
    return false;
  });
  $(".year").click(function(event) {
    event.preventDefault();
    $('#year_year').val($(this).html());
    $('#edit_year_hidden').val($(this).html());
    // var url = "<%= @currentyr.avatar.url %>"
    // console.log("<%= @currentyr.inspect %>")
    // console.log(url);
    // $(".avatar").html("<img src ='" + url + "'>");
    var val = $(this).html();
    // this is how you send data to the backend...
    $.get( "/<%= @user.name %>/" + val, function(data) {
      console.log("get" + val);
    });

    
    

    console.log(val);
    // changes the sentence "this is me at..."
    $('.intro span').html(val);
    // find the post of the year that is clicked
    findContent(val);
  

    history.replaceState({}, '', "/" + gon.username + '/' + val );
      return false;
  });
});
</script>